extends ../layout
include ./includes/proceedButton
include ./includes/utils


block content

    - var unsuitable = licenceStatus.decisions.unsuitable && !licenceStatus.decisions.exceptionalCircumstances

    div.back-link-container
        a.link-back(href="/") Back to case list

        if licenceStatus.decisions.excluded
            div.error-banner.marginTopMedium
                strong.bold The offender is statutorily excluded from HDC
        else if unsuitable
            div.error-banner.marginTopMedium
                strong.bold The offender is presumed unsuitable for HDC release

    if !user.role
        p Error
    else if !prisonerInfo
        p No offender details found
    else

        include prisonerDetails

        if user.role === 'CA'
            if (['UNSTARTED', 'ELIGIBILITY'].includes(licenceStatus.stage))
                include eligibilityTask
                if licenceStatus.decisions.eligible
                    include proposedAddressTask
                    include caSubmitTask
                else if licenceStatus.decisions.insufficientTimeStop
                    include caSubmitRefusalTask


            else
                include curfewAddressTask
                if (licenceStatus.decisions.curfewAddressApproved !== 'rejected')
                    include riskManagementTask
                    include curfewHoursTask
                    include additionalConditionsTask
                    include reportingInstructionsTask
                include finalChecksTask
                include postponementTask
                include caSubmitTask

        if user.role === 'RO'
            if (licenceStatus.decisions.optedOut)
                include optOutTask
            else
                include curfewAddressTask
                if (licenceStatus.decisions.curfewAddressApproved !== 'rejected')
                    include riskManagementTask
                    include curfewHoursTask
                    include additionalConditionsTask
                    include reportingInstructionsTask
                    include optOutTask
            include roSubmitTask

        if user.role === 'DM'
            include curfewAddressTask
            if (licenceStatus.decisions.curfewAddressApproved !== 'rejected')
                include riskManagementTask
                include curfewHoursTask
                include additionalConditionsTask
                include reportingInstructionsTask
            include finalChecksTask
            include approvalTask
